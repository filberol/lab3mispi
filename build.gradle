plugins {
    id 'java'
    id 'org.jetbrains.kotlin.jvm' version '1.6.20'
    id 'org.jetbrains.kotlin.plugin.allopen' version '1.6.20'
    id 'org.jetbrains.kotlin.plugin.noarg' version '1.6.20'
    id 'war'
}

group 'com.lab3web'
version '1.0-SNAPSHOT'

repositories { mavenCentral() }

sourceCompatibility = '1.8'
targetCompatibility = '1.8'

[compileKotlin, compileTestKotlin].forEach {
    it.kotlinOptions {
        jvmTarget = '1.8'
    }
}

dependencies {
    // Jpa
    implementation('jakarta.platform:jakarta.jakartaee-api:9.1.0')
    implementation('jakarta.mvc:jakarta.mvc-api:2.0.0')
    implementation('org.eclipse.persistence:org.eclipse.persistence.jpa:3.0.3')

    // Dont update
    implementation("org.hibernate.common:hibernate-commons-annotations:5.1.2.Final")
    implementation("org.hibernate:hibernate-core:5.6.10.Final")

    // Hibernate
    implementation('org.hibernate.validator:hibernate-validator:8.0.0.Final')
    implementation('org.postgresql:postgresql:42.5.1')

    // Front
    implementation("org.primefaces:primefaces:12.0.0:jakarta")

    // Tests
    testImplementation("org.junit.jupiter:junit-jupiter-api:5.9.3")
    testImplementation("org.mockito:mockito-core:5.3.1")
    testRuntimeOnly('org.junit.vintage:junit-vintage-engine:5.9.2')
}



compileKotlin {
    kotlinOptions {
        jvmTarget = '1.8'
        allWarningsAsErrors = true
    }
}

// Register commands

tasks.register("compile_m") {
    group "mispi_tasks"
    buildDir = "build"
    dependsOn(compileKotlin)
    doLast {
        println("Compiled kotlin into $buildDir")
    }

}

tasks.register("build_m", War) {
    group "mispi_tasks"
    dependsOn(compile_m)
    manifest {
        "Manifest-Version: 1.0"
    }
    archiveBaseName = "deployment"
    archiveAppendix = ""
    archiveVersion = ""
    doLast {
        println("Build war package in $buildDir")
    }
}

tasks.register("clean_m", Delete) {
    group "mispi_tasks"
    delete buildDir
}

test {
    useJUnitPlatform()
}